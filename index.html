<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="åŒè‰²çƒé€‰å·">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#e60012">
    <meta name="description" content="ä¸­å›½ç¦åˆ©å½©ç¥¨åŒè‰²çƒæ™ºèƒ½é€‰å·ç³»ç»Ÿï¼Œå¸¦æœ‰ç²¾ç¾åŠ¨ç”»æ•ˆæœ">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <title>ä¸­å›½ç¦åˆ©å½©ç¥¨åŒè‰²çƒæ™ºèƒ½é€‰å·</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json" crossorigin="use-credentials">
    <link rel="icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="apple-touch-icon-precomposed" href="apple-touch-icon-precomposed.png">
    <link rel="apple-touch-startup-image" href="icon-192.png">
    <script src="script.js" defer></script>
    <style>
        .btn-active {
            background-color: #ff3340 !important;
            transform: scale(0.97) !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
        }
        
        .selected-ball {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            margin: 5px;
            font-size: 1.2rem;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16);
            opacity: 0;
            transform: scale(0);
            animation: popIn 0.5s forwards;
        }
        
        .selected-red {
            background: radial-gradient(circle at 30% 30%, #ff6b6b, #e60012);
        }
        
        .selected-blue {
            background: radial-gradient(circle at 30% 30%, #5c9eff, #0066cc);
            margin-left: 15px;
        }
        
        @keyframes popIn {
            0% {
                opacity: 0;
                transform: scale(0) rotate(-180deg);
            }
            70% {
                opacity: 1;
                transform: scale(1.2) rotate(10deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotate(0);
            }
        }
        
        .selected-numbers {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .lucky-message {
            opacity: 0;
            animation: fadeIn 1s 1s forwards;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        .ball {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            position: absolute;
            font-size: 0.8rem;
            z-index: 1;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .red-ball {
            background: radial-gradient(circle at 30% 30%, #ff6b6b, #e60012);
        }
        
        .blue-ball {
            background: radial-gradient(circle at 30% 30%, #5c9eff, #0066cc);
        }
        
        @keyframes float {
            0% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(5px, 5px) rotate(5deg); }
            50% { transform: translate(0, 10px) rotate(0deg); }
            75% { transform: translate(-5px, 5px) rotate(-5deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }
        
        /* æ·»åŠ å¯åŠ¨å±æ ·å¼ */
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #f5f7fa;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        #splash-screen.hide {
            opacity: 0;
            pointer-events: none;
        }
        
        #splash-screen img {
            width: 120px;
            height: 120px;
            margin-bottom: 20px;
        }
        
        #splash-screen p {
            color: #666;
            font-size: 16px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(230, 0, 18, 0.2);
            border-radius: 50%;
            border-top-color: #e60012;
            animation: spin 1s ease-in-out infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <!-- å¯åŠ¨å± -->
    <div id="splash-screen">
        <img src="icon-192.png" alt="åŒè‰²çƒé€‰å·">
        <p>æ™ºèƒ½é€‰å·ç³»ç»Ÿ</p>
        <div class="loading-spinner"></div>
    </div>

    <div class="container">
        <header>
            <h1>ä¸­å›½ç¦åˆ©å½©ç¥¨åŒè‰²çƒ</h1>
            <h2>æ™ºèƒ½é€‰å·ç³»ç»Ÿ</h2>
        </header>
        
        <div class="lottery-machine">
            <div class="machine-container">
                <div class="red-balls-container">
                    <div class="balls-circle" id="redBallsCircle">
                        <!-- Red balls will be generated here -->
                    </div>
                </div>
                <div class="blue-balls-container">
                    <div class="balls-circle" id="blueBallsCircle">
                        <!-- Blue balls will be generated here -->
                    </div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button id="generateBtn" class="btn" onclick="doGenerateClick()">å¼€å§‹é€‰å·</button>
            <button id="resetBtn" class="btn" onclick="doResetClick()">é‡æ–°å¼€å§‹</button>
        </div>

        <div class="result">
            <h3>æ‚¨çš„å¹¸è¿å·ç :</h3>
            <div class="selected-numbers">
                <div id="redNumbers"></div>
                <div id="blueNumbers"></div>
            </div>
            <div class="lucky-message" id="luckyMessage"></div>
            
            <!-- ä»Šæ—¥å·²é€‰å·ç åŒºåŸŸ -->
            <div id="savedResults" class="saved-results" style="display:none;">
                <hr style="margin: 20px 0; border-top: 1px dashed #ccc;">
                <h3 style="color: #0066cc;">ä»Šæ—¥å·²é€‰å·ç ï¼š</h3>
                <div id="savedSelectionsList"></div>
            </div>
        </div>
        
        <div id="offlineStatus" style="display: none; text-align: center; margin-top: 1rem;">
            <p style="color: #666; background-color: #f8f8f8; padding: 0.5rem; border-radius: 5px; font-size: 0.9rem;">
                ğŸ”Œ å½“å‰å¤„äºç¦»çº¿æ¨¡å¼
            </p>
        </div>
    </div>

    <footer>
        <p>ä»…ä¾›å¨±ä¹ï¼Œç¥æ‚¨å¥½è¿ï¼</p>
        <p class="install-tip">æ·»åŠ åˆ°ä¸»å±å¹•ä»¥è·å¾—æœ€ä½³ä½“éªŒ</p>
    </footer>

    <script>
        // å¤„ç†å¯åŠ¨å±
        document.addEventListener("DOMContentLoaded", function() {
            // éšè—å¯åŠ¨å±
            setTimeout(function() {
                const splashScreen = document.getElementById('splash-screen');
                if (splashScreen) {
                    splashScreen.classList.add('hide');
                    // å®Œå…¨ç§»é™¤å¯åŠ¨å±
                    setTimeout(function() {
                        splashScreen.style.display = 'none';
                    }, 500);
                }
            }, 1500); // 1.5ç§’åéšè—
        });
        
        // æ£€æµ‹æ˜¯å¦ä»¥ç‹¬ç«‹åº”ç”¨è¿è¡Œ
        function isRunningStandalone() {
            return (window.matchMedia('(display-mode: standalone)').matches) || 
                   (window.navigator.standalone) || 
                   document.referrer.includes('android-app://');
        }
        
        // æ˜¾ç¤º/éšè—æ·»åŠ åˆ°ä¸»å±å¹•æç¤º
        function updateInstallTip() {
            const installTip = document.querySelector('.install-tip');
            if (installTip) {
                installTip.style.display = isRunningStandalone() ? 'none' : 'block';
            }
        }
        
        // æ£€æµ‹æ˜¾ç¤ºæ¨¡å¼å˜åŒ–
        window.matchMedia('(display-mode: standalone)').addEventListener('change', updateInstallTip);
        
        // å…¨å±€å˜é‡
        var isSelecting = false;
        var selectedRedBalls = [];
        var selectedBlueBalls = [];
        
        // é¡µé¢åŠ è½½ååˆå§‹åŒ–çƒ
        window.addEventListener('load', function() {
            initializeBalls();
            updateInstallTip();
        });
        
        // åˆå§‹åŒ–çƒå‡½æ•°
        function initializeBalls() {
            const redBallsCircle = document.getElementById('redBallsCircle');
            const blueBallsCircle = document.getElementById('blueBallsCircle');
            
            if (!redBallsCircle || !blueBallsCircle) {
                console.error('æ‰¾ä¸åˆ°çƒå®¹å™¨å…ƒç´ ');
                return;
            }
            
            // æ¸…ç©ºå®¹å™¨
            redBallsCircle.innerHTML = '';
            blueBallsCircle.innerHTML = '';
            
            // è·å–å®¹å™¨å°ºå¯¸
            const redContainerRect = redBallsCircle.getBoundingClientRect();
            const blueContainerRect = blueBallsCircle.getBoundingClientRect();
            
            // æ ¹æ®å®¹å™¨å°ºå¯¸è°ƒæ•´åŠå¾„
            const redRadius = Math.min(redContainerRect.width, redContainerRect.height) / 2.5;
            const blueRadius = Math.min(blueContainerRect.width, blueContainerRect.height) / 2.5;
            
            // åˆ›å»ºçº¢çƒ
            for (let i = 1; i <= 33; i++) {
                const ball = document.createElement('div');
                ball.className = 'ball red-ball';
                ball.textContent = i;
                redBallsCircle.appendChild(ball);
                
                // éšæœºä½ç½®
                const angle = Math.random() * 2 * Math.PI;
                const radius = Math.random() * redRadius;
                const x = radius * Math.cos(angle);
                const y = radius * Math.sin(angle);
                
                ball.style.left = `calc(50% + ${x}px)`;
                ball.style.top = `calc(50% + ${y}px)`;
                
                // åº”ç”¨æµ®åŠ¨åŠ¨ç”»
                ball.style.animation = `float ${3 + Math.random() * 2}s ease-in-out infinite`;
                ball.style.animationDelay = `${Math.random() * 2}s`;
            }
            
            // åˆ›å»ºè“çƒ
            for (let i = 1; i <= 16; i++) {
                const ball = document.createElement('div');
                ball.className = 'ball blue-ball';
                ball.textContent = i;
                blueBallsCircle.appendChild(ball);
                
                // éšæœºä½ç½®
                const angle = Math.random() * 2 * Math.PI;
                const radius = Math.random() * blueRadius;
                const x = radius * Math.cos(angle);
                const y = radius * Math.sin(angle);
                
                ball.style.left = `calc(50% + ${x}px)`;
                ball.style.top = `calc(50% + ${y}px)`;
                
                // åº”ç”¨æµ®åŠ¨åŠ¨ç”»
                ball.style.animation = `float ${3 + Math.random() * 2}s ease-in-out infinite`;
                ball.style.animationDelay = `${Math.random() * 2}s`;
            }
        }
        
        // ç›´æ¥çš„æŒ‰é’®ç‚¹å‡»å¤„ç†å‡½æ•°
        function doGenerateClick() {
            console.log("å¼€å§‹é€‰å·æŒ‰é’®è¢«ç‚¹å‡»");
            document.getElementById('generateBtn').classList.add('btn-active');
            setTimeout(function() {
                document.getElementById('generateBtn').classList.remove('btn-active');
            }, 300);
            
            // ç®€å•çš„è§¦è§‰åé¦ˆ
            if (navigator.vibrate) navigator.vibrate(50);
            
            // è°ƒç”¨script.jsä¸­çš„startSelectionå‡½æ•°
            try {
                if (typeof window.startSelection === 'function') {
                    window.startSelection();
                } else {
                    console.error('startSelectionå‡½æ•°ä¸å¯ç”¨');
                    alert('ç³»ç»Ÿæ­£åœ¨åˆå§‹åŒ–ï¼Œè¯·ç¨åå†è¯•');
                }
            } catch (e) {
                console.error('è°ƒç”¨startSelectionå‡ºé”™:', e);
            }
        }
        
        function doResetClick() {
            console.log("é‡æ–°å¼€å§‹æŒ‰é’®è¢«ç‚¹å‡»");
            document.getElementById('resetBtn').classList.add('btn-active');
            setTimeout(function() {
                document.getElementById('resetBtn').classList.remove('btn-active');
            }, 300);
            
            // ç®€å•çš„è§¦è§‰åé¦ˆ
            if (navigator.vibrate) navigator.vibrate(50);
            
            // è°ƒç”¨script.jsä¸­çš„resetSelectionå‡½æ•°
            try {
                if (typeof window.resetSelection === 'function') {
                    window.resetSelection();
                } else {
                    console.error('resetSelectionå‡½æ•°ä¸å¯ç”¨');
                    alert('ç³»ç»Ÿæ­£åœ¨åˆå§‹åŒ–ï¼Œè¯·ç¨åå†è¯•');
                }
            } catch (e) {
                console.error('è°ƒç”¨resetSelectionå‡ºé”™:', e);
            }
        }
        
        // ç›‘å¬ç½‘ç»œçŠ¶æ€å˜åŒ–
        window.addEventListener('load', function() {
            var offlineStatus = document.getElementById('offlineStatus');
            
            function updateOnlineStatus() {
                if (navigator.onLine) {
                    if (offlineStatus) offlineStatus.style.display = 'none';
                } else {
                    if (offlineStatus) offlineStatus.style.display = 'block';
                }
            }
            
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
            
            // åˆå§‹æ£€æŸ¥
            updateOnlineStatus();
        });
    </script>
    
    <script>
        // Service Workeræ³¨å†Œ
        if ('serviceWorker' in navigator) {
            // ç¡®ä¿é¡µé¢åŠ è½½å®Œæˆåæ³¨å†ŒService Worker
            window.addEventListener('load', function() {
                // æ³¨å†Œsw.jsä½œä¸ºä¸»è¦Service Worker
                navigator.serviceWorker.register('./sw.js', {scope: './'})
                    .then(function(registration) {
                        console.log('Service Worker (sw.js) æ³¨å†ŒæˆåŠŸ:', registration.scope);
                    })
                    .catch(function(error) {
                        console.error('Service Worker (sw.js) æ³¨å†Œå¤±è´¥:', error);
                        
                        // å°è¯•æ³¨å†Œå¤‡ç”¨ service-worker.js
                        console.log('å°è¯•æ³¨å†Œå¤‡ç”¨ Service Worker...');
                        navigator.serviceWorker.register('./service-worker.js', {scope: './'})
                            .then(function(registration) {
                                console.log('å¤‡ç”¨ Service Worker æ³¨å†ŒæˆåŠŸ:', registration.scope);
                            })
                            .catch(function(backupError) {
                                console.error('å¤‡ç”¨ Service Worker æ³¨å†Œä¹Ÿå¤±è´¥:', backupError);
                            });
                    });
            });
            
            // ç›‘å¬Service Workerçš„çŠ¶æ€å˜åŒ–
            navigator.serviceWorker.addEventListener('controllerchange', function() {
                console.log('Service Workerå·²æ›´æ–°å¹¶æ¥ç®¡é¡µé¢');
            });
            
            // æ£€æŸ¥Service Workeræ›´æ–°
            if (navigator.serviceWorker.controller) {
                navigator.serviceWorker.controller.postMessage({
                    type: 'CHECK_VERSION',
                    version: 'lottery-app-v13'
                });
            }
            
            // ç›‘å¬Service Workeræ¶ˆæ¯
            navigator.serviceWorker.addEventListener('message', function(event) {
                if (event.data.type === 'RELOAD_PAGE') {
                    console.log('æ”¶åˆ°Service Workeré‡æ–°åŠ è½½æŒ‡ä»¤');
                    window.location.reload();
                }
            });
        } else {
            console.warn('æµè§ˆå™¨ä¸æ”¯æŒService Workerï¼Œç¦»çº¿åŠŸèƒ½å°†ä¸å¯ç”¨');
        }
    </script>
</body>
</html> 